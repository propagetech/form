# Project Plan: 50 Secure Database-Driven Websites in 10 Days

## Executive Summary
This plan outlines the strategy to deliver 50 individual websites with custom forms, secure database storage, and email notifications within a 10-day timeframe. The core strategy relies on a **Centralized Architecture** where a single robust backend engine serves all 50 lightweight, vanilla frontends. This maximizes code reuse, simplifies security auditing, and ensures rapid deployment.

## 1. Technical Architecture Requirements

### A. Frontend (The 50 Websites)
*   **Stack**: Vanilla HTML5, CSS3, JavaScript (ES6+).
*   **Structure**: Each website is a static directory containing:
    *   `index.html`: Semantic markup.
    *   `style.css`: Custom styling using CSS Variables for rapid theming.
    *   `script.js`: Handles form validation, reCAPTCHA token retrieval, and async (fetch) submission to the backend API.
*   **No Frameworks**: Pure DOM manipulation and native browser APIs.

### B. Backend (The Core Engine)
*   **Role**: A centralized API handling form submissions for all domains.
*   **Stack**: Node.js (using built-in `http`/`https` modules or minimal routing) or Go.
    *   *Reasoning*: High concurrency for handling email/DB I/O without blocking.
*   **Database**: Self-hosted **PostgreSQL**.
    *   **Schema**: Multi-tenant design.
        *   `sites` table: Configs for each website (owner email, SMTP settings, allowed domains).
        *   `submissions` table: Stores form data (JSONB for flexibility with 1-50 forms).
*   **Email System**:
    *   Nodemailer (or similar minimal lib) connected to a local Postfix instance or dedicated SMTP relay.
    *   **PDF Attachment**: Dynamic PDF generation using a library (e.g., `pdfkit`) or HTML-to-PDF converter, attached to the acknowledgment email.

## 2. Security Implementation Standards

*   **OWASP Compliance**:
    *   **SQL Injection**: Strict use of Parameterized Queries (Prepared Statements).
    *   **XSS**: Input sanitization on the backend; Content Security Policy (CSP) headers on frontend.
    *   **CSRF**: Anti-CSRF tokens generated by the backend, validated on submission. SameSite cookie policies.
*   **ReCAPTCHA**: Integration of Google reCAPTCHA v3 (invisible) on all forms.
*   **Cloudflare Integration (New)**:
    *   **SSL/TLS**: Automatic Edge SSL provided by Cloudflare for all 50 domains.
    *   **WAF**: Enable Cloudflare WAF to block common attacks (SQLi, XSS) before they reach the server.
    *   **DDoS Protection**: Basic unmetered DDoS mitigation included.
*   **Encryption**:
    *   **Data at Rest**: Database volume encryption (LUKS) and sensitive field hashing.
    *   **Data in Transit**: HTTPS (TLS 1.3) enforced via Nginx for all domains.
*   **Access Control**:
    *   API requires an API Key or Origin validation per site.
    *   Internal Admin Dashboard protected by MFA.

## 3. Development Workflow & Timeline (10 Days)

### Phase 1: Core Engine & Security (Days 1-3)
*   **Day 1**: Setup VPS, Install PostgreSQL, Nginx, Git. Initialize Backend Repository.
*   **Day 2**: Implement Generic Form Handler API (POST /submit), DB Schema, and Validation Logic.
*   **Day 3**: Implement Security (CSRF, Rate Limiting, ReCAPTCHA verification) and Email/PDF Logic.

### Phase 2: "Factory" Setup (Days 4-5)
*   **Day 4**: Create the **Frontend Generator Script**.
    *   Input: `sites.json` (contains domain, colors, form fields for each site).
    *   Output: 50 folders with customized HTML/CSS.
*   **Day 5**: Build reusable CSS "Master Theme" and JS Form Handler component. Run initial integration tests.

### Phase 3: Production Assembly (Days 6-8)
*   **Day 6**: Generate first 25 sites. Deploy to Staging. Run automated UI tests (Puppeteer/Selenium).
*   **Day 7**: Generate remaining 25 sites. Penetration Testing (Automated scans + Manual logic checks).
*   **Day 8**: Fix security findings. Finalize email templates and PDF generation.

### Phase 4: Go-Live & Handover (Days 9-10)
*   **Day 9**: DNS Propagation. SSL Certificate provisioning (Let's Encrypt wildcard or bulk). Live Deployment.
*   **Day 10**: Final verification, Monitoring setup, Documentation handover.

## 4. Infrastructure & Cost Optimization

### Recommended Provider: DigitalOcean or Hetzner
*   **Why**: Best price-to-performance ratio for self-managed infrastructure.
*   **Setup**:
    *   **1 x High-Performance VPS** (e.g., 4 vCPU, 8GB RAM) - ~$40-60/month.
        *   Hosts Nginx (Reverse Proxy for 50 domains).
        *   Hosts Node.js API Backend.
        *   Hosts PostgreSQL Database.
    *   **Storage**: NVMe SSD for fast DB access.
*   **Cost Saving**: Shared infrastructure means you pay for 1 server, not 50.
*   **Backup**: Daily snapshots + Automated S3/Spaces off-site backup script.

## 5. Deliverables & Success Criteria Checklist
- [ ] 50 Unique URLs live with HTTPS.
- [ ] Form submissions save to DB and trigger emails.
- [ ] PDF links working in auto-replies.
- [ ] Security Audit Report (Pass).
- [ ] Uptime Monitor Dashboard (e.g., Uptime Kuma self-hosted).

## 6. Post-Deployment Strategy
*   **Maintenance**: Ansible playbooks to update Nginx configs or Backend logic across all sites simultaneously.
*   **Analytics**: Self-hosted Matomo or simple server-log analysis (GoAccess) to respect privacy and avoid 3rd parties.
*   **Support**: Ticket system (e.g., self-hosted osTicket) for reporting issues.
